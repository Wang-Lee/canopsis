<!--
#--------------------------------
# Copyright (c) 2011 "Capensis" [http://www.capensis.com]
#
# This file is part of Canopsis.
#
# Canopsis is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Canopsis is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with Canopsis.  If not, see <http://www.gnu.org/licenses/>.
# ---------------------------------
-->

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <title>Canopsis</title>

	<!-- Theme -->
	<link rel="stylesheet" type="text/css" href="resources/lib/bootstrap/css/pnotify_bootstrap.css">
	
	<link rel="stylesheet" type="text/css" href="themes/extjs/css/ext-all-gray.css">
	<link rel="stylesheet" type="text/css" href="themes/default/theme.css">
	<link rel="stylesheet" type="text/css" href="themes/canopsis/theme.css">

	<link rel="stylesheet" type="text/css" href="resources/lib/jquery-ui/theme/jquery-ui.css">
	
	<link rel="stylesheet" type="text/css" href="resources/lib/jqGridable/jqGridable.css">
	<link rel="stylesheet" type="text/css" href="resources/lib/extjs-plugins/CheckHeader.css">
	
	<link rel="stylesheet" type="text/css" href="resources/lib/pnotify/jquery.pnotify.default.css">
	<!-- <link rel="stylesheet" type="text/css" href="resources/lib/pnotify/icons/jquery.pnotify.default.icons.css"> -->

	<link rel="stylesheet" type="text/css" href="/ui/widgets.css">

	<!-- Ext-JS -->
	<script type="text/javascript" src="resources/lib/extjs/ext-all.js.gz"></script>

	<!-- Ext localization javascript -->
	<script type="text/javascript" id="extlocale"></script>

	<!-- Jquery -->
	<script type="text/javascript" src="resources/lib/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="resources/lib/jquery-ui/jquery-ui.min.js"></script>
	
	<script type="text/javascript" src="resources/lib/jQuery.encoding.digests.sha1.js"></script>
	<script type="text/javascript" src="resources/lib/jquery.md5.js"></script>
	<script type="text/javascript" src="resources/lib/jquery.peity.min.js"></script>
	<script type="text/javascript" src="resources/lib/jquery.sparkline.js"></script>
	<script type="text/javascript" src="resources/lib/jquery.lightbox-0.5.js"></script>
	<script type="text/javascript" src="resources/lib/jquery.jsPlumb-1.3.13-all-min.js"></script>
	<script type="text/javascript" src="resources/lib/sigma.min.js"></script>

	<script type="text/javascript" src="resources/lib/justGage/raphael.2.1.0.min.js"></script>
	<script type="text/javascript" src="resources/lib/justGage/justgage.js"></script>
	
	<script type="text/javascript" src="resources/lib/jqGridable/jqGridable.js"></script>
	
	<script type="text/javascript" src="resources/lib/pnotify/jquery.pnotify.min.js"></script>   
 
	<!-- Highcharts -->
	<!-- <script type="text/javascript" src="resources/lib/Highcharts/js/highcharts.js"></script> -->
	<script type="text/javascript" src="resources/lib/Highstock/js/highstock.js"></script>
	<script type="text/javascript" src="resources/lib/regression.js"></script>
	<script type="text/javascript" src="resources/lib/Highstock/js/modules/exporting.js"></script>

	<!-- Extjs Plugins -->
	<script type="text/javascript" src="resources/lib/jqGridable/jqGridable.Ext.js"></script>
	<script type="text/javascript" src="resources/lib/extjs-plugins/Ext.ux.ColorField.js"></script>
	<script type="text/javascript" src="resources/lib/extjs-plugins/Ext.ux.CheckColumn.js"></script>

	<!-- Locales -->
	<script type="text/javascript" src="locales.js"></script>

	<!-- Application -->
	<script type="text/javascript" src="commit.js"></script>
	<!-- <script type="text/javascript" src="canopsis.min.js.gz"></script> -->
	<script type="text/javascript" src="canopsis.js"></script>

	<!-- NowJS -->
	<script type="text/javascript" id="nowjs"></script>

</head>

<body>
	<div id="auth" class='login'>
		<div class='header'></div>
		<div class='title'><img src="themes/canopsis/resources/images/logo_canopsis_auth.png"></img></div>
		<div class='layout'></div>
		<div id='auth_form' class='form'></div>
	</div>

	<script type="text/javascript">
		Ext.onDocumentReady(function() {
			global.minimified = true

			//check Auth
			log.debug('Check auth ...', "[index]");
			Ext.Ajax.request({
				type: 'rest',
				url: '/account/me',
				reader: {
					type: 'json',
					root: 'data',
					totalProperty  : 'total',
					successProperty: 'success'
				},
				success: function(response){
					request_state = Ext.JSON.decode(response.responseText).success
					if (request_state){
						global.account = Ext.JSON.decode(response.responseText).data[0];
						log.debug(' + Logged', "[app]");

						Ext.get('auth').remove();

						createApplication()
					} else {
						log.debug(' + Please loggin', "[index]");
					}
				},
				failure: function(response) {
					if (response.status == 403){
						log.debug(' + Please loggin', "[index]");

						Ext.create('canopsis.auth', {
							on_authed: function(){
								Ext.get('auth').remove();
								createApplication();
							}
						})
					}else{
						document.getElementById('loading-msg').innerHTML = 'Impossible to load Canopsis ...';
						log.debug(' + Error in request', "[index]");
					}
				}
			});
		});
	</script>

</body>
</html>
